<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seating Chart Layout Creator</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [tables, setTables] = useState([]);
            const gridRows = 12;
            const gridCols = 8;

            const handleCellClick = (row, col) => {
                const existingTable = tables.find(t => t.gridRow === row && t.gridCol === col);
                
                // If clicking an existing table, rotate it
                if (existingTable) {
                    setTables(prev => prev.map(t => 
                        t.internalId === existingTable.internalId 
                        ? {...t, orientation: t.orientation === 'vertical' ? 'horizontal' : 'vertical'} 
                        : t
                    ));
                    return;
                }

                // Add a new table
                const existingIds = new Set(tables.map(t => t.internalId));
                let newId = 1;
                while (existingIds.has(newId)) {
                    newId++;
                }

                const newTable = { 
                    internalId: newId, 
                    displayId: `${newId}`, 
                    capacity: 10, 
                    orientation: 'horizontal', 
                    gridRow: row, 
                    gridCol: col 
                };
                setTables(prev => [...prev, newTable].sort((a, b) => a.internalId - b.internalId));
            };

            const handleDelete = (e, tableId) => {
                e.stopPropagation();
                setTables(prev => prev.filter(t => t.internalId !== tableId));
            };

            const handleExport = () => {
                const exportData = tables.map(({ internalId, displayId, orientation, gridRow, gridCol, capacity }) => ({
                    internalId,
                    displayId,
                    orientation,
                    gridRow,
                    gridCol,
                    capacity
                }));
                
                const jsonString = `data:text/json;charset=utf-8,${encodeURIComponent(
                    JSON.stringify(exportData, null, 2)
                )}`;
                const link = document.createElement("a");
                link.href = jsonString;
                link.download = "layout.json";
                link.click();
            };
            
            const handleReset = () => {
                if (window.confirm("Are you sure you want to clear the entire layout?")) {
                    setTables([]);
                }
            }

            return (
                <div className="container mx-auto p-4 sm:p-6 lg:p-8">
                    <div className="text-center mb-6">
                        <h1 className="text-3xl font-bold text-gray-800">Seating Chart Layout Creator</h1>
                        <p className="text-gray-600 mt-2">Click an empty cell to add a table. Click a table to rotate it. Click the 'x' to delete.</p>
                    </div>

                    <div className="flex justify-center mb-6 space-x-4">
                        <button onClick={handleExport} className="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all">
                            Export layout.json
                        </button>
                         <button onClick={handleReset} className="px-6 py-2 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all">
                            Reset Layout
                        </button>
                    </div>

                    <div className="bg-white p-4 rounded-xl shadow-lg">
                        <div className="grid gap-2" style={{ gridTemplateColumns: `repeat(${gridCols}, minmax(0, 1fr))`}}>
                            {Array.from({ length: gridRows * gridCols }).map((_, index) => {
                                const row = Math.floor(index / gridCols);
                                const col = index % gridCols;
                                const tableHere = tables.find(t => t.gridRow === row && t.gridCol === col);
                                
                                return (
                                    <div 
                                        key={`${row}-${col}`} 
                                        onClick={() => handleCellClick(row, col)} 
                                        className={`w-full h-24 bg-gray-100 rounded border-2 border-dashed border-gray-300 hover:bg-green-100 hover:border-green-400 cursor-pointer flex items-center justify-center transition-colors`}
                                    >
                                       {tableHere ? (
                                           <div className={`relative rounded p-1 ${tableHere.orientation === 'vertical' ? 'w-8 h-16' : 'w-16 h-8'} bg-green-400 flex items-center justify-center shadow-md`}>
                                                <span className="text-white font-bold text-sm">{tableHere.displayId}</span>
                                                <button onClick={(e) => handleDelete(e, tableHere.internalId)} className="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold leading-none hover:bg-red-700">&times;</button>
                                           </div>
                                       ) : (
                                          <div className="w-6 h-6 bg-gray-300 rounded-full opacity-50">+</div>
                                       )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
